<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1448" height="1292"><desc>title%20OpenAI%20proxy%20call%20flows%20diagram%0A%0Aparticipant%20%22Main%20Application%20with%20TinyMCE%5CnComponent%201%22%20as%20TinyMCE%0Aparticipant%20%22Proxy%5CnComponent%202%22%20as%20Proxy%0Aparticipant%20%22Integrator%20Auth%20Endpoint%5CnComponent%203%22%20as%20Integrator%20Auth%20Endpoint%0Aparticipant%20%22OpenAI%20Moderation%20API%5CnComponent%204%22%20as%20OpenAI%20Moderation%20API%0Aparticipant%20%22OpenAI%20Chat%20Completions%20API%5CnComponent%205%22%20as%20OpenAI%20Chat%20Completions%20API%0A%0A%0ATinyMCE-%3EProxy%3A%20Chat%20completion%20request%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Fai-request.js%23L9%3E%5BRef-1%5D%3C%2Flink%3E%0AProxy-%3EIntegrator%20Auth%20Endpoint%3A%20Allow%20this%20chat%20completion%20request%3F%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fauthz.rego%23L16%3E%5BRef-2%5D%3C%2Flink%3E%0AProxy%3C--Integrator%20Auth%20Endpoint%3A%20200%20OK%20(Allow%20this%20request)%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Findex.js%23L55%3E%5BRef-2.1%5D%3C%2Flink%3E%0AProxy-%3EOpenAI%20Moderation%20API%3A%20Does%20this%20request%20pass%20the%20moderation%20standards%3F%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fauthz.rego%23L20%3E%5BRef-3%5D%3C%2Flink%3E%0AProxy%3C--OpenAI%20Moderation%20API%3A%20No%20moderation%20flags%20-%20request%20would%20be%20accepted%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fopenai.rego%23L97%3E%5BRef-3.1%5D%3C%2Flink%3E%0Anote%20over%20Proxy%3A%20Attach%20OpenAI%20API%20token%20to%20request%0AProxy-%3EOpenAI%20Chat%20Completions%20API%3A%20Chat%20completion%20request%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fauthz.rego%23L25%3E%5BRef-4%5D%3C%2Flink%3E%0AProxy%3C--OpenAI%20Chat%20Completions%20API%3A%20Chat%20completion%20response%20%5BRef-4.1%5D%0ATinyMCE%3C--Proxy%3A%20Chat%20completion%20response%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Fai-request.js%23L37%3E%5BRef-1.1%5D%3C%2Flink%3E%0A%0Aalt%20auth%20failure%20call%20flow%0ATinyMCE-%3EProxy%3A%20Chat%20completion%20request%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Fai-request.js%23L9%3E%5BRef-1%5D%3C%2Flink%3E%0AProxy-%3EIntegrator%20Auth%20Endpoint%3A%20Allow%20this%20chat%20completion%20request%3F%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fauthz.rego%23L16%3E%5BRef-2%5D%3C%2Flink%3E%0AProxy%3C--Integrator%20Auth%20Endpoint%3A%20403%20OK%20(Deny%20this%20request)%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Findex.js%23L55%3E%5BRef-2.2%5D%3C%2Flink%3E%0ATinyMCE%3C--Proxy%3A%20403%20Forbidden%20(failed%20authentication)%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fwebapp.rego%23L7%3E%5BRef-1.2a%5D%3C%2Flink%3E%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Fai-request.js%23L31%3E%5BRef-1.2b%5D%3C%2Flink%3E%0Aend%0A%0Aalt%20moderation%20failure%20call%20flow%0ATinyMCE-%3EProxy%3A%20Chat%20completion%20request%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Fai-request.js%23L9%3E%5BRef-1%5D%3C%2Flink%3E%0AProxy-%3EIntegrator%20Auth%20Endpoint%3A%20Allow%20this%20chat%20completion%20request%3F%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fauthz.rego%23L16%3E%5BRef-2%5D%3C%2Flink%3E%0AProxy%3C--Integrator%20Auth%20Endpoint%3A%20200%20OK%20(Allow%20this%20request)%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Findex.js%23L55%3E%5BRef-2.1%5D%3C%2Flink%3E%0AProxy-%3EOpenAI%20Moderation%20API%3A%20Does%20this%20request%20pass%20the%20moderation%20standards%3F%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fauthz.rego%23L20%3E%5BRef-3%5D%3C%2Flink%3E%0AProxy%3C--OpenAI%20Moderation%20API%3A%20Moderation%20flags%20triggered%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fconfig%2Fopenai.rego%23L97%3E%5BRef-3.2%5D%3C%2Flink%3E%0ATinyMCE%3C--Proxy%3A%20400%20Bad%20Request%20(failed%20moderation)%20%3Clink%3Ahttps%3A%2F%2Fgithub.com%2Ftinymce%2Fopenai-proxy-reference-implementation%2Fblob%2Fmain%2Fexample-app%2Fai-request.js%23L31%3E%5BRef-1.3%5D%3C%2Flink%3E%0Aend%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1448" height="1292"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="566.4715219470951" y="26.3876361" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">OpenAI proxy call flows diagram</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.64167113573828 120.679455764 L 128.64167113573828 1292.290498604" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 120.679455764 L 551.2364958820924 1292.290498604" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 876.0074375718059 120.679455764 L 876.0074375718059 1292.290498604" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1089.3342078551393 120.679455764 L 1089.3342078551393 1292.290498604" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1321.5209391036667 120.679455764 L 1321.5209391036667 1292.290498604" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.795878699999989 55.765870958 L 248.48746357147655 55.765870958 L 248.48746357147655 120.67945576399998 L 8.795878699999989 120.67945576399998 L 8.795878699999989 55.765870958 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="27.882935478999997" y="85.495940964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Main Application with TinyMCE</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="84.63308806689062" y="103.087698364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Component 1</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 488.14085603424473 55.765870958 L 614.3321357299401 55.765870958 L 614.3321357299401 120.67945576399998 L 488.14085603424473 120.67945576399998 L 488.14085603424473 55.765870958 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.499931245862" y="85.495940964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Proxy</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.22791281324476" y="103.087698364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Component 2</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 777.457276544759 55.765870958 L 974.5575985988528 55.765870958 L 974.5575985988528 120.67945576399998 L 777.457276544759 120.67945576399998 L 777.457276544759 55.765870958 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.544333323759" y="85.495940964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Integrator Auth Endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="831.9988545029582" y="103.087698364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Component 3</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 992.8312804096354 55.765870958 L 1185.8371353006432 55.765870958 L 1185.8371353006432 120.67945576399998 L 992.8312804096354 120.67945576399998 L 992.8312804096354 55.765870958 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1011.9183371886354" y="85.495940964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">OpenAI Moderation API</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1045.3256247862917" y="103.087698364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Component 4</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1203.4288927006432 55.765870958 L 1439.6129855066902 55.765870958 L 1439.6129855066902 120.67945576399998 L 1203.4288927006432 120.67945576399998 L 1203.4288927006432 55.765870958 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1222.5159494796433" y="85.495940964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">OpenAI Chat Completions API</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1277.512356034819" y="103.087698364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Component 5</text></g></g><g><g><g><rect fill="white" stroke="none" x="233.81431220848566" y="155.862970564" width="212.24954260085937" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="236.45307581848567" y="171.695552224" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Chat completion request </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/ai-request.js#L9"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="399.43082850403255" y="171.695552224" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-1]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.64167113573828 178.732255184 L 536.7526156227591 178.732255184" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(551.2364958820924,178.732255184) translate(-551.2364958820924,-178.732255184)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 536.5766980487591 171.40235626733332 L 551.2364958820924 178.732255184 L 536.5766980487591 186.06215410066667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="572.0534088054258" y="205.11989128399998" width="283.1371158430469" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="574.6921724154257" y="220.952472944" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Allow this chat completion request? </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/authz.rego#L16"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="808.5574983431601" y="220.952472944" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-2]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 227.98917590399998 L 861.5235573124726 227.98917590399998" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(876.0074375718059,227.98917590399998) translate(-876.0074375718059,-227.98917590399998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 861.3476397384726 220.6592769873333 L 876.0074375718059 227.98917590399998 L 861.3476397384726 235.31907482066666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="591.6167480388242" y="254.37681200399996" width="244.01043737625" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="594.2555116488242" y="270.20939366399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK (Allow this request) </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/index.js#L55"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="776.7679628206992" y="270.20939366399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-2.1]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 876.0074375718059 277.24609662399996 L 565.7203761414257 277.24609662399996" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(551.2364958820924,277.24609662399996) translate(-551.2364958820924,-277.24609662399996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.8962937154257 269.9161977073333 L 551.2364958820924 277.24609662399996 L 565.8962937154257 284.5759955406666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="629.8155946062722" y="303.63373272399997" width="380.9395145246875" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="632.4543582162721" y="319.466314384" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Does this request pass the moderation standards? </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/authz.rego#L20"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="964.1220828256471" y="319.466314384" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-3]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 326.50301734399994 L 1074.850327595806 326.50301734399994" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1089.3342078551393,326.50301734399994) translate(-1089.3342078551393,-326.50301734399994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1074.674410021806 319.1731184273333 L 1089.3342078551393 326.50301734399994 L 1074.674410021806 333.8329162606666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="627.7754945086159" y="352.89065344399995" width="385.01971472" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="630.4142581186159" y="368.72323510399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">No moderation flags - request would be accepted </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/openai.rego#L97"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="953.9359866342409" y="368.72323510399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-3.1]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1089.3342078551393 375.7599380639999 L 565.7203761414257 375.7599380639999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(551.2364958820924,375.7599380639999) translate(-551.2364958820924,-375.7599380639999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.8962937154257 368.4300391473333 L 551.2364958820924 375.7599380639999 L 565.8962937154257 383.0898369806666 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 410.4806551509987 402.14757416399993 L 676.1597549531862 402.14757416399993 L 691.9923366131861 417.98015582399995 L 691.9923366131861 442.6086161839999 L 410.4806551509987 442.6086161839999 L 410.4806551509987 402.14757416399993 M 676.1597549531862 402.14757416399993 L 676.1597549531862 417.98015582399995 L 691.9923366131861 417.98015582399995" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="435.10911551099866" y="426.7760345239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Attach OpenAI API token to request</text></g><g><g><rect fill="white" stroke="none" x="830.2539461924499" y="468.9962522839999" width="212.24954260085937" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="832.8927098024499" y="484.82883394399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Chat completion request </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/authz.rego#L25"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="995.8704624879967" y="484.82883394399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-4]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 491.8655369039999 L 1307.0370588443334 491.8655369039999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1321.5209391036667,491.8655369039999) translate(-1321.5209391036667,-491.8655369039999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1306.8611412703333 484.53563798733325 L 1321.5209391036667 491.8655369039999 L 1306.8611412703333 499.19543582066655 Z"/></g></g><g><g><rect fill="white" stroke="none" x="818.4357699229187" y="518.2531730039999" width="235.88589513992187" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="821.0745335329186" y="534.0857546639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Chat completion response [Ref-4.1]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1321.5209391036667 541.1224576239999 L 565.7203761414257 541.1224576239999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(551.2364958820924,541.1224576239999) translate(-551.2364958820924,-541.1224576239999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.8962937154257 533.7925587073332 L 551.2364958820924 541.1224576239999 L 565.8962937154257 548.4523565406666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="221.9961359389544" y="567.510093724" width="235.88589513992187" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="224.63489954895442" y="583.3426753839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Chat completion response </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/ai-request.js#L37"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="399.0228084845013" y="583.3426753839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-1.1]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 590.379378344 L 143.12555139507162 590.379378344" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(128.64167113573828,590.379378344) translate(-128.64167113573828,-590.379378344)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 143.3014689690716 583.0494794273333 L 128.64167113573828 590.379378344 L 143.3014689690716 597.7092772606667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="233.81431220848566" y="664.264759424" width="212.24954260085937" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="236.45307581848567" y="680.0973410839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Chat completion request </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/ai-request.js#L9"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="399.43082850403255" y="680.0973410839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-1]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.64167113573828 687.134044044 L 536.7526156227591 687.134044044" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(551.2364958820924,687.134044044) translate(-551.2364958820924,-687.134044044)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 536.5766980487591 679.8041451273333 L 551.2364958820924 687.134044044 L 536.5766980487591 694.4639429606667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="572.0534088054258" y="713.521680144" width="283.1371158430469" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="574.6921724154257" y="729.354261804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Allow this chat completion request? </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/authz.rego#L16"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="808.5574983431601" y="729.354261804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-2]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 736.390964764 L 861.5235573124726 736.390964764" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(876.0074375718059,736.390964764) translate(-876.0074375718059,-736.390964764)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 861.3476397384726 729.0610658473333 L 876.0074375718059 736.390964764 L 861.3476397384726 743.7208636806668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="592.0211822429258" y="762.778600864" width="243.20156896804687" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="594.6599458529257" y="778.611182524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">403 OK (Deny this request) </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/index.js#L55"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="776.3635286165976" y="778.611182524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-2.2]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 876.0074375718059 785.6478854840001 L 565.7203761414257 785.6478854840001" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(551.2364958820924,785.6478854840001) translate(-551.2364958820924,-785.6478854840001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.8962937154257 778.3179865673334 L 551.2364958820924 785.6478854840001 L 565.8962937154257 792.9777844006668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="149.4585840590716" y="812.0355215840001" width="380.9609988996875" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="152.0973476690716" y="827.868103244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">403 Forbidden (failed authentication) </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/webapp.rego#L7"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="394.9605221075482" y="827.868103244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-1.2a]</text></a><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="459.3341640753216" y="827.868103244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/ai-request.js#L31"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="463.4071773809857" y="827.868103244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-1.2b]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 834.9048062040001 L 143.12555139507162 834.9048062040001" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(128.64167113573828,834.9048062040001) translate(-128.64167113573828,-834.9048062040001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 143.3014689690716 827.5749072873334 L 128.64167113573828 834.9048062040001 L 143.3014689690716 842.2347051206668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="233.81431220848566" y="935.1778233840001" width="212.24954260085937" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="236.45307581848567" y="951.0104050440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Chat completion request </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/ai-request.js#L9"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="399.43082850403255" y="951.0104050440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-1]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.64167113573828 958.0471080040002 L 536.7526156227591 958.0471080040002" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(551.2364958820924,958.0471080040002) translate(-551.2364958820924,-958.0471080040002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 536.5766980487591 950.7172090873335 L 551.2364958820924 958.0471080040002 L 536.5766980487591 965.3770069206669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="572.0534088054258" y="984.4347441040002" width="283.1371158430469" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="574.6921724154257" y="1000.2673257640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Allow this chat completion request? </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/authz.rego#L16"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="808.5574983431601" y="1000.2673257640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-2]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 1007.3040287240002 L 861.5235573124726 1007.3040287240002" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(876.0074375718059,1007.3040287240002) translate(-876.0074375718059,-1007.3040287240002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 861.3476397384726 999.9741298073335 L 876.0074375718059 1007.3040287240002 L 861.3476397384726 1014.6339276406669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="591.6167480388242" y="1033.6916648240003" width="244.01043737625" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="594.2555116488242" y="1049.5242464840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK (Allow this request) </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/index.js#L55"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="776.7679628206992" y="1049.5242464840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-2.1]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 876.0074375718059 1056.5609494440002 L 565.7203761414257 1056.5609494440002" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(551.2364958820924,1056.5609494440002) translate(-551.2364958820924,-1056.5609494440002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.8962937154257 1049.2310505273335 L 551.2364958820924 1056.5609494440002 L 565.8962937154257 1063.890848360667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="629.8155946062722" y="1082.9485855440003" width="380.9395145246875" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="632.4543582162721" y="1098.7811672040002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Does this request pass the moderation standards? </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/authz.rego#L20"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="964.1220828256471" y="1098.7811672040002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-3]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 1105.8178701640002 L 1074.850327595806 1105.8178701640002" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1089.3342078551393,1105.8178701640002) translate(-1089.3342078551393,-1105.8178701640002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1074.674410021806 1098.4879712473335 L 1089.3342078551393 1105.8178701640002 L 1074.674410021806 1113.1477690806669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="702.3424119280495" y="1132.2055062640002" width="235.8858798811328" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="704.9811755380495" y="1148.0380879240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Moderation flags triggered </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/config/openai.rego#L97"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="879.3690692148073" y="1148.0380879240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-3.2]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1089.3342078551393 1155.074790884 L 565.7203761414257 1155.074790884" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(551.2364958820924,1155.074790884) translate(-551.2364958820924,-1155.074790884)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.8962937154257 1147.7448919673334 L 551.2364958820924 1155.074790884 L 565.8962937154257 1162.4046898006668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="187.35763954002863" y="1181.462426984" width="305.16288793777346" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="189.99640315002864" y="1197.295008644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">400 Bad Request (failed moderation) </text><a xlink:href="https://github.com/tinymce/openai-proxy-reference-implementation/blob/main/example-app/ai-request.js#L31"><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="underline" x="433.6613048834271" y="1197.295008644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Ref-1.3]</text></a></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 551.2364958820924 1204.331711604 L 143.12555139507162 1204.331711604" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(128.64167113573828,1204.331711604) translate(-128.64167113573828,-1204.331711604)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 143.3014689690716 1197.0018126873333 L 128.64167113573828 1204.331711604 L 143.3014689690716 1211.6616105206667 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 67.07052023573829 616.767014444 L 937.5785884718059 616.767014444 L 937.5785884718059 861.2924423040001 L 67.07052023573829 861.2924423040001 L 67.07052023573829 616.767014444 Z" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 67.07052023573829 616.767014444 L 67.07052023573829 637.877123324 L 115.9428320328086 637.877123324 L 126.4978864728086 627.322068884 L 126.4978864728086 616.767014444 L 67.07052023573829 616.767014444" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="84.66227763573829" y="630.840420364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="141.4508802628086" y="618.1743550360001" width="125.84777868484375" height="18.295427696"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="144.0896438728086" y="630.840420364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[auth failure call flow]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 67.07052023573829 887.6800784040001 L 1150.9053587551393 887.6800784040001 L 1150.9053587551393 1230.719347704 L 67.07052023573829 1230.719347704 L 67.07052023573829 887.6800784040001 Z" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 67.07052023573829 887.6800784040001 L 67.07052023573829 908.7901872840001 L 115.9428320328086 908.7901872840001 L 126.4978864728086 898.2351328440002 L 126.4978864728086 887.6800784040001 L 67.07052023573829 887.6800784040001" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="84.66227763573829" y="901.7534843240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="141.4508802628086" y="889.0874189960002" width="164.95536840652343" height="18.295427696"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="144.0896438728086" y="901.7534843240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[moderation failure call flow]</text></g></g></g></svg>